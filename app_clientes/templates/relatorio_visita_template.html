<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ficha de Visita</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body { 
            font-family: Helvetica, sans-serif; 
            font-size: 10px; 
            color: #333; 
            line-height: 1.3; 
        }
        
        /* HEADER */
        .header { width: 100%; border-bottom: 2px solid #2563eb; padding-bottom: 10px; margin-bottom: 15px; }
        .header-content { width: 100%; }
        .logo { max-height: 50px; }
        .company-info { text-align: right; font-size: 9px; color: #666; }
        
        /* TITULOS */
        h1 { font-size: 16px; color: #1e3a8a; margin: 0; text-transform: uppercase; text-align: center; }
        h3 { 
            font-size: 11px; 
            color: #000; 
            margin-top: 15px; 
            margin-bottom: 5px; 
            text-transform: uppercase; 
            font-weight: bold; 
            border-bottom: 1px solid #ccc; 
            padding-bottom: 2px;
        }
        
        /* TABELAS DE DADOS */
        .box { background-color: #f8fafc; border: 1px solid #e2e8f0; padding: 5px; border-radius: 4px; margin-bottom: 10px; }
        .label { font-weight: bold; color: #475569; text-transform: uppercase; font-size: 8px; }
        .value { color: #000; font-size: 10px; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 2px; }
        td { padding: 4px; vertical-align: top; }
        
        /* TABELA DE IMÓVEIS */
        .table-imoveis { width: 100%; margin-top: 5px; border: 1px solid #eee; }
        .table-imoveis th { background-color: #eff6ff; color: #1e3a8a; font-weight: bold; text-align: left; padding: 6px; font-size: 9px; text-transform: uppercase; }
        .table-imoveis td { border-bottom: 1px solid #eee; padding: 6px; font-size: 9px; }

        /* DECLARAÇÕES (Texto Jurídico) */
        .legal-text { font-size: 9px; text-align: justify; color: #333; margin-bottom: 5px; }
        ul { margin: 2px 0 5px 15px; padding: 0; }
        li { margin-bottom: 4px; text-align: justify; font-size: 9px; }

        /* SEÇÃO DE ASSINATURAS */
        .signature-section { margin-top: 20px; font-size: 10px; page-break-inside: avoid; }
        .signature-row { margin-bottom: 15px; }
        .signature-label { font-weight: bold; display: inline-block; width: 280px; }
        .signature-line { display: inline-block; border-bottom: 1px solid #000; width: 300px; }
        
        /* Imagem da assinatura digital */
        .img-digital { 
            height: 40px; 
            margin-left: 10px; 
            vertical-align: bottom; 
            position: relative; 
            top: 10px; /* Ajuste visual para ficar sobre a linha */
        }

        /* RODAPÉ */
        #footer {
            position: fixed;
            bottom: -10px;
            left: 0;
            right: 0;
            height: 30px;
            text-align: center;
            font-size: 8px;
            color: #777;
            border-top: 1px solid #eee;
            padding-top: 5px;
        }
        
        .legal-disclaimer {
            margin-top: 30px;
            font-size: 8px;
            text-align: center;
            font-style: italic;
            color: #666;
            border-top: 1px solid #ddd;
            padding-top: 5px;
        }
    </style>
</head>
<body>

    <div id="footer">
        Documento gerado pelo sistema ImobHome em {{ data_impressao|date:"d/m/Y H:i:s" }}.
        <br>
        Página <pdf:pagenumber> de <pdf:pagecount>
    </div>

    <div class="header">
        <table class="header-content">
            <tr>
                <td style="width: 50%;">
                    {% if logo_b64 %}
                        <img src="{{ logo_b64 }}" class="logo" alt="Logo">
                    {% else %}
                        <h1>{{ imobiliaria.nome|default:"IMOBILIÁRIA" }}</h1>
                    {% endif %}
                </td>
                <td style="width: 50%; text-align: right;">
                    <div class="company-info">
                        <strong>{{ imobiliaria.nome }}</strong><br>
                        {{ imobiliaria.cnpj|default:"" }}<br>
                        {{ imobiliaria.email_contato|default:"" }}
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <h1>Ficha de Visita #{{ visita.id }}</h1>

    <div class="box">
        <table>
            <tr>
                <td width="33%">
                    <div class="label">Data da Visita</div>
                    <div class="value">{{ visita.data_visita|date:"d/m/Y" }} às {{ visita.data_visita|date:"H:i" }}</div>
                </td>
                <td width="33%">
                    <div class="label">Cliente Visitante</div>
                    <div class="value">{{ cliente.nome }}</div>
                    <div style="font-size:8px">Tel: {{ cliente.telefone|default:"-" }}</div>
                </td>
                <td width="33%">
                    <div class="label">Corretor Responsável</div>
                    <div class="value">{{ corretor.get_full_name|default:corretor.username }}</div>
                </td>
            </tr>
        </table>
    </div>

    <h3>2. IMÓVEIS VISITADOS</h3>
    <table class="table-imoveis">
        <thead>
            <tr>
                <th width="15%">Ref.</th>
                <th width="50%">Endereço</th>
                <th width="35%">Bairro/Cidade</th>
            </tr>
        </thead>
        <tbody>
            {% for imovel in imoveis %}
            <tr>
                <td><strong>{{ imovel.codigo_referencia|default:imovel.id }}</strong></td>
                <td>{{ imovel.logradouro }}, {{ imovel.numero }}</td>
                <td>{{ imovel.bairro }} - {{ imovel.cidade }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" align="center">Nenhum imóvel listado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if visita.observacoes %}
    <div style="margin-top:10px; font-size:9px; color:#555;">
        <strong>Observações:</strong> {{ visita.observacoes }}
    </div>
    {% endif %}

    <h3>3. DECLARAÇÕES DO VISITANTE</h3>
    <div class="legal-text">
        Declaro, para os devidos fins, que:
        <ul>
            <li>Estou visitando o imóvel acima identificado por intermédio da imobiliária informada neste termo;</li>
            <li>Tive conhecimento do imóvel por apresentação direta da imobiliária, corretor(a) ou preposto autorizado;</li>
            <li>Comprometo-me a não negociar direta ou indiretamente a compra, locação ou qualquer outro tipo de transação envolvendo este imóvel sem a intermediação da imobiliária, pelo prazo de 180 (cento e oitenta) dias, salvo autorização expressa e por escrito da mesma;</li>
            <li>Reconheço que a imobiliária faz jus à comissão de corretagem prevista em lei (Lei nº 6.530/78 e Código Civil, art. 725), caso a negociação venha a se concretizar, ainda que por terceiros, desde que decorrente desta visita;</li>
            <li>Autorizo o uso dos meus dados pessoais exclusivamente para fins de cadastro, controle de visitas e intermediação imobiliária, em conformidade com a Lei Geral de Proteção de Dados – LGPD (Lei nº 13.709/2018).</li>
        </ul>
    </div>

    <h3>4. RESPONSABILIDADE</h3>
    <div class="legal-text">
        Declaro que estou ciente de que a visita não implica reserva do imóvel, tampouco obrigação de proposta, e que eventuais danos causados ao imóvel durante a visita serão de minha inteira responsabilidade.
    </div>

    <h3>5. DATA E ASSINATURAS</h3>
    
    <div class="signature-section">
        
        <div class="signature-row">
            <span style="font-weight:bold;">Local e Data:</span> 
            <span style="border-bottom: 1px solid #000; display: inline-block; width: 400px; padding-left: 10px;">
                {% with principal=imoveis|first %}
                    {{ principal.cidade|default:"Cidade" }}
                {% endwith %}, {{ visita.data_visita|date:"d/m/Y" }}
            </span>
        </div>

        <div class="signature-row">
            <div style="margin-bottom: 2px;">Assinatura do Visitante:</div>
            <div style="border-bottom: 1px solid #000; width: 400px; display: inline-block; height: 30px; vertical-align: bottom;">
                {% if assinatura_cliente_b64 %}
                    <img src="{{ assinatura_cliente_b64 }}" style="height: 45px; margin-bottom: -5px;">
                {% endif %}
            </div>
            <br>
            <span style="font-size: 9px;">Nome: {{ cliente.nome }}</span>
        </div>

        <div class="signature-row">
            <div style="margin-bottom: 2px;">Assinatura do Corretor(a) / Representante da Imobiliária:</div>
            <div style="border-bottom: 1px solid #000; width: 400px; display: inline-block; height: 30px; vertical-align: bottom;">
                {% if assinatura_corretor_b64 %}
                    <img src="{{ assinatura_corretor_b64 }}" style="height: 45px; margin-bottom: -5px;">
                {% endif %}
            </div>
        </div>

        <div class="signature-row">
            Nome do Corretor(a): <span style="border-bottom: 1px solid #ccc; padding: 0 10px; min-width: 200px; display: inline-block;">
                {{ corretor.get_full_name|default:corretor.username }}
            </span>
            <br><br>
            CRECI: <span style="border-bottom: 1px solid #ccc; padding: 0 10px; min-width: 150px; display: inline-block;">
                {{ corretor.perfil.creci|default:"" }}
            </span>
        </div>

    </div>

    <div class="legal-disclaimer">
        Este documento possui caráter declaratório e serve como prova da intermediação imobiliária, podendo ser utilizado para fins administrativos e judiciais.
    </div>

</body>
</html>